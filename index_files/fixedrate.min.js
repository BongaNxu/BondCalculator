function initFloatLayer(e){var t=jQuery(window).width(),a=jQuery(window).height(),n=0,i=0,r=0,o=0;document.body&&(n=document.body.scrollWidth,i=document.body.scrollHeight,r=document.body.scrollLeft,o=document.body.scrollTop),document.documentElement&&(n=Math.min(n,document.documentElement.scrollWidth),i=Math.max(i,document.documentElement.scrollHeight),r=Math.max(r,document.documentElement.scrollLeft),o=Math.max(o,document.documentElement.scrollTop));var l=Math.max(n,t),s=Math.max(i,a);jQuery("#MLCalcShader").css({width:l,height:s,top:0,left:0,opacity:"0.5"}).show().click(function(){jQuery("#MLCalcShader").fadeOut(300),jQuery("#MLCalcHolder, #MLCalcClose").hide(),jQuery("#MLCalcFrame").remove(),showObjects()});var d=parseInt((t-680)/2)+r,c=parseInt((a-e)/2)+o;0>d&&(d=0),0>c&&(c=0),hideObjects(d,c,d+680,c+e),jQuery("#MLCalcHolder").css({width:680,height:e,top:c,left:d}).show(),jQuery("#MLCalcHolder #MLCalcFrame").size()<1&&jQuery("#MLCalcHolder").html('<iframe src="#" scrolling="no" id="MLCalcFrame" name="MLCalcFrame" width="0" height="0" allowtransparency="true" style="background-color: transparent; display: none"></iframe><iframe id="garbageFrame" style="display:none"></iframe>'),jQuery("#MLCalcHolder").find("#MLCalcFrame").css({width:680,height:e}).load(function(){jQuery(this).show(),jQuery("#MLCalcHolder #garbageFrame").attr("src",""),jQuery("#MLCalcClose").show().css({height:25,width:25}).css({top:c,left:d+jQuery("#MLCalcHolder").width()-2-jQuery("#MLCalcClose").width()}).click(function(){jQuery("#MLCalcShader").fadeOut(300),jQuery("#MLCalcHolder, #MLCalcClose").hide(),jQuery("#MLCalcFrame").remove(),showObjects()}).hover(function(){jQuery(this).css({background:"#F5F5F5",color:"#808080"})},function(){jQuery(this).css({background:"#D5D5D5",color:"#F5F5F5"})})})}function hideObjects(e,t,a,n){jQuery("OBJECT").each(function(){var i=jQuery(this).offset();oX1=i.left,oY1=i.top,oX2=oX1+jQuery(this).width(),oY2=oY1+jQuery(this).height(),((e>oX1&&oX2>e||a>oX1&&oX2>a)&&(t>oY1&&oY2>t||n>oY1&&oY2>n)||(oX1>e&&a>oX1||oX2>e&&a>oX2)&&(oY1>t&&n>oY1||oY2>t&&n>oY2))&&jQuery(this).attr("originalVisibility",jQuery(this).css("visibility")).css("visibility","hidden").attr("hiddenBy","MLCalc")}),"msie"==jQuery.browser&&jQuery.browser.version<7&&jQuery("SELECT").each(function(){jQuery(this).attr("originalVisibility",jQuery(this).css("visibility")).css("visibility","hidden").attr("hiddenBy","MLCalc")})}function showObjects(){jQuery("OBJECT[hiddenBy=MLCalc]").each(function(){jQuery(this).css("visibility",jQuery(this).attr("originalVisibility")).removeAttr("originalVisibility").removeAttr("hiddenBy")}),"msie"==jQuery.browser&&jQuery.browser.version<7&&jQuery("SELECT[hiddenBy=MLCalc]").each(function(){jQuery(this).css("visibility",jQuery(this).attr("originalVisibility")).removeAttr("originalVisibility").removeAttr("hiddenBy")})}function mlcalcCalculate(e){if(jQuery("INPUT[name=ma]",e).size()){var t=new Array("ma","dp","mt","ir","pt","pi","mi","sm","sy","wl","cr");for(i=0;i<t.length;i++)mInput=t[i],jQuery("INPUT[name="+mInput+"]","#mlcalcMortgageForm").val(jQuery("*[name="+mInput+"]",e).val());jQuery("INPUT[name=as]","#mlcalcMortgageForm").val(jQuery("INPUT[name=as]:checked",e).val()),initFloatLayer("none"==jQuery("INPUT[name=as]:checked",e).val()?319:570),jQuery("#mlcalcMortgageForm").attr("target","MLCalcFrame"),jQuery("#mlcalcMortgageForm").submit()}else if(jQuery("INPUT[name=la]",e).size()){var t=new Array("la","lt","ir","sm","sy","wl","cr");for(i=0;i<t.length;i++)mInput=t[i],jQuery("INPUT[name="+mInput+"]","#mlcalcLoanForm").val(jQuery("*[name="+mInput+"]",e).val());jQuery("INPUT[name=as]","#mlcalcLoanForm").val(jQuery("INPUT[name=as]:checked",e).val()),initFloatLayer("none"==jQuery("INPUT[name=as]:checked",e).val()?302:550),jQuery("#mlcalcLoanForm").attr("target","MLCalcFrame"),jQuery("#mlcalcLoanForm").submit()}return!1}function processLink(e){if(-1!=e.search(/^http\:\/\/www\.mlcalc\.com/i)){lang=e.replace(/^.+\/([^\/]{2})\/#.+$/,"$1"),2!=lang.length&&(lang="en"),e=e.replace(/^.+#(.+)$/,"$1");var t=e.split("-");switch(t[0]){case"mortgage":var a="none"==t[10]?319:570;initFloatLayer(a),jQuery("#mlcalcMortgageForm").find("INPUT[name=ma]").val(t[1]),jQuery("#mlcalcMortgageForm").find("INPUT[name=dp]").val(t[2]),jQuery("#mlcalcMortgageForm").find("INPUT[name=mt]").val(t[3]),jQuery("#mlcalcMortgageForm").find("INPUT[name=ir]").val(t[4]),jQuery("#mlcalcMortgageForm").find("INPUT[name=pt]").val(t[5]),jQuery("#mlcalcMortgageForm").find("INPUT[name=pi]").val(t[6]),jQuery("#mlcalcMortgageForm").find("INPUT[name=mi]").val(t[7]),jQuery("#mlcalcMortgageForm").find("INPUT[name=sm]").val(t[8]),jQuery("#mlcalcMortgageForm").find("INPUT[name=sy]").val(t[9]),jQuery("#mlcalcMortgageForm").find("INPUT[name=as]").val(t[10]),jQuery("#mlcalcMortgageForm").find("INPUT[name=wl]").val(lang),jQuery("#mlcalcMortgageForm").attr("target","MLCalcFrame"),jQuery("#mlcalcMortgageForm").submit();break;case"loan":var a="none"==t[6]?302:550;initFloatLayer(a),jQuery("#mlcalcLoanForm").find("INPUT[name=la]").val(t[1]),jQuery("#mlcalcLoanForm").find("INPUT[name=lt]").val(t[2]),jQuery("#mlcalcLoanForm").find("INPUT[name=ir]").val(t[3]),jQuery("#mlcalcLoanForm").find("INPUT[name=sm]").val(t[4]),jQuery("#mlcalcLoanForm").find("INPUT[name=sy]").val(t[5]),jQuery("#mlcalcLoanForm").find("INPUT[name=as]").val(t[6]),jQuery("#mlcalcLoanForm").find("INPUT[name=wl]").val(lang),jQuery("#mlcalcLoanForm").attr("target","MLCalcFrame"),jQuery("#mlcalcLoanForm").submit()}}}function toggleContent(){var e='Hide payment schedule <i aria-hidden="true" class="fa fa-chevron-up"></i>',t='View payment schedule <i aria-hidden="true" class="fa fa-chevron-down"></i>';if($(".table-toggle a").first().fadeToggle("fast"),$("div.table-area").toggleClass("hidden"),$("div.table-area").is(":visible"))$(".table-toggle a").html(e);else{$(".table-toggle a").html(t);var a=$(".calculators").offset().top,n=$(".nav--main").height();$("html, body").animate({scrollTop:a-n},1e3)}}Number.prototype.formatMoney=function(e,t,a){var n=this,e=isNaN(e=Math.abs(e))?2:e,t=void 0==t?".":t,a=void 0==a?",":a,i=0>n?"-":"",r=String(parseInt(n=Math.abs(Number(n)||0).toFixed(e))),o=(o=r.length)>3?o%3:0;return i+(o?r.substr(0,o)+a:"")+r.substr(o).replace(/(\d{3})(?=\d)/g,"$1"+a)+(e?t+Math.abs(n-r).toFixed(e).slice(2):"")};var defaultDataSet={fill:!0,lineTension:0,borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",pointBackgroundColor:"#fff",pointBorderWidth:1,pointHoverRadius:5,pointHoverBackgroundColor:"rgba(192, 75, 75, 1)",pointHoverBorderColor:"rgba(220,220,220,1)",pointHoverBorderWidth:2,pointRadius:1,pointHitRadius:10,spanGaps:!1},defaultChartOptions={type:"line",options:{maintainAspectRatio:!0,scales:{yAxes:[{ticks:{callback:function(e){return parseInt(e)>1e3?"R"+e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"R"+e}}}]}}};$(function(){function e(e,t){var a=$("#fixed-rate-results"),i=$("form.data-area");i.insertAfter(t),a.insertAfter(i),n.showAffordability(e)}function t(e,t){var a=e.which?e.which:event.keyCode;return 45==a&&-1==$(t).val().indexOf("-")||46==a&&-1==$(t).val().indexOf(".")||!(48>a||a>57)?!0:!1}var a=function(){return this.fields={initialPaymentMonth:"#payment-month",downPaymentPercent:"#down-payment",propertyInsurance:"#property-insurance",interestRate:"#interest-rate",additionalPayments:"#additional-payments",propertyTax:"#property-tax",startMonth:"#payment-month",startYear:"#payment-year",totalCost:"#loan-amount",loanTerm:"#loan-term"},this.amortizationSchedule=!1,this.getInputs=function(){var e=this;$.each(Object.keys(this.fields),function(t,a){e[a]=parseInt(100*$(e.fields[a]).val(),10)/100}),this.downPaymentPercent=this.downPaymentPercent/100,this.paymentsPerYear=12,this.downPayment=this.totalCost*this.downPaymentPercent,this.loanAmount=this.totalCost-this.downPayment,this.additionalPayments=this.additionalPayments;var t=.006161*(this.totalCost-2e5)/12;return $("#property-tax").val(this.loanAmount<2e5?"0.00":t.toFixed(2)),this.monthlyTax=t,this.monthlyInsurance=this.propertyInsurance/12,this},this.runBindings=function(){var e=this,t=Object.keys(this.fields).map(function(t){return e.fields[t]}).join(", ");return $(t+", input[name=show-by]").on("change",function(){e.run()}),$("#down-payment").on("change",e.calcDownPayment),this},this.run=function(){return this.getInputs().validateFields().computeSchedule().createPage()},this.showAffordability=function(e){return this.affordabilityView=e,e&&($("#down-payment").val(0),$("#property-insurance").val(0),$("#property-tax").val(3e3),$(".affordability-calc").show()),this.run()},this.updateDownPayment=function(){var e=(this.downPaymentPercent*this.totalCost).formatMoney(2);return $(".down-payment .total").html("R"+e),this},this.showPayments=function(e){var t=this.calcPayment();this.monthlyTax=this.monthlyTax<0?0:this.monthlyTax;var a=this.monthlyTax+t+this.monthlyInsurance,n='<div class="monthly-totals"><table>';return n+='<tr><td id="pai">R'+t.formatMoney(2)+"</td><td>Principle & Interest</td></tr>",n+='<tr><td id="ins" class="disable">+ R'+this.monthlyInsurance.formatMoney(2)+'</td><td class="disable">Insurance</td></tr>',n+='<tr><td id="taxes">+ R'+this.monthlyTax.formatMoney(2)+"</td><td>Property Taxes</td></tr>",n+='<tr><td id="monthly_payment">R'+a.formatMoney(2)+'</td><td class="totals">Monthly Payment</td></tr></table></div>',e.append(n),this},this.showChart=function(e){var t,a=[];for(t=$('<canvas id="fixed-rate-chart" width="678" height="296" style="margin-bottom: 15px"></canvas>'),e.append(t),i=1;i<this.loanTerm+1;i++)a.push([]);$.each(this.schedule,function(e,t){a[t.paymentYearIndex-1].push(t)});var n=a.map(function(e){var t=e.reduce(function(e,t){return e+=t.interestPayment},0);return Math.round(100*t)/100}),r=a.map(function(e){var t=e.reduce(function(e,t){return e+=t.principlePayment},0);return Math.round(100*t)/100}),o={labels:Object.keys(a).map(function(e){return year=parseInt(e,10)+1,"Year "+year}),datasets:[$.extend({backgroundColor:"rgba(0, 147, 208, 0.4)",borderColor:"rgba(0, 147, 208, 1)",pointBorderColor:"rgba(0, 147, 208, 1)",label:"Interest",data:n},defaultDataSet),$.extend({backgroundColor:"rgba(148, 201, 71, 0.4)",borderColor:"rgba(148, 201, 71, 1)",pointBorderColor:"rgba(148, 201, 71, 1)",label:"Principle",data:r},defaultDataSet)]};return this.amortizationSchedule=new Chart(t,$.extend({data:o},defaultChartOptions)),this},this.showSchedule=function(e){var t,a=this,n=[],r=this.startYear,o='<div class="table-toggle"><a class="button button--blue--solid" onclick="toggleContent();">View payment schedule <i aria-hidden="true" class="fa fa-chevron-down"></i></a></div>';if(o+='<div class="table-area hidden">',o+='<table class="pretty" id="fixed-rate-table" width="80%"><thead><tr><th>Payment</th><th>Principle Paid</th><th>Interest Paid</th>',o+='<th class="affordability-calc">Property Taxes Paid</th>',o+="<th>Principle Remaining</th></tr></thead><tbody></tbody></table>",o+='<div class="table-toggle"><a class="button button--blue--solid" onclick="toggleContent();">View payment schedule <i aria-hidden="true" class="fa fa-chevron-down"></i></a></div>',o+="</div>",t=$(o),e.append(t),"year"==$("input[name=show-by]:checked").val()){for(i=0;i<this.loanTerm+1;i++)n[r+i]=[];$.each(this.schedule,function(e,t){n[t.paymentYear].push(t)}),$.each(Object.keys(n).map(function(e){var t=n[e];return t.reduce(function(e,t){return e.principlePayment+=t.principlePayment,e.interestPayment+=t.interestPayment,e.remainingPrinciple=t.remainingPrinciple,e.paymentYear=t.paymentYear,e},{principlePayment:0,interestPayment:0,remainingPrinciple:0,paymentYear:0})}),function(e,n){var i="<tr>";i+="<td> "+parseInt(n.paymentYear)+"</td>",i+="<td> R"+(parseInt(Math.round(100*n.principlePayment))/100).formatMoney(2)+"</td>",i+="<td> R"+(parseInt(Math.round(100*n.interestPayment))/100).formatMoney(2)+"</td>",i+='<td class="align-right affordability-calc"> R'+(parseInt(Math.round(12*(a.monthlyTax+a.monthlyInsurance)*100))/100).formatMoney(2)+"</td>",i+="<td> R"+(parseInt(Math.round(100*n.remainingPrinciple))/100).formatMoney(2)+"</td>",i+="</tr>",t.find("tbody").append(i)})}else $.each(this.schedule,function(e,n){var i="<tr>";i+="<td> "+n.paymentMonth+"/"+n.paymentYear+"</td>",i+="<td> R"+(parseInt(Math.round(100*n.principlePayment))/100).formatMoney(2)+"</td>",i+="<td> R"+(parseInt(Math.round(100*n.interestPayment))/100).formatMoney(2)+"</td>",i+='<td class="align-right affordability-calc"> R'+(parseInt(Math.round(100*(a.monthlyTax+a.monthlyInsurance)))/100).formatMoney(2)+"</td>",i+="<td> R"+(parseInt(Math.round(100*n.remainingPrinciple))/100).formatMoney(2)+"</td>",i+="</tr>",t.find("tbody").append(i)})},this.createPage=function(){var e=$("#fixed-rate-results");return e.empty(),this.updateDownPayment().showPayments(e).showChart(e).showSchedule(e)},this.validateFields=function(){return this.loanTerm>100&&$("#loan-term").val(100),this.loanAmount>=1e8&&$("#loan-amount").val(99999999),this.interestRate>=100&&$("#interest-rate").val(99),this.downPaymentPercent>.9&&$("#down-payment").val(90),this.getInputs()},this.calcPayment=function(){var e,t=this.interestRate/100/this.paymentsPerYear;return e=Math.pow(1+t,this.loanTerm*this.paymentsPerYear),t/(e-1)*-(-this.loanAmount*e)},this.computeSchedule=function(){for(var e=[],t=this.loanAmount,a=this.paymentsPerYear*this.loanTerm,n=this.calcPayment(),i=this.startYear,r=this.startMonth-1,o=1,l=0,s=0;a>s;s++){l+=1,13==l&&(l=1,o+=1),r+=1,r>12&&(r=1,i+=1);var d=t*(this.interestRate/100/this.paymentsPerYear),c=n-d;t-=c;var m={paymentNumber:s,principlePayment:c>0?n>c?c:n:0,interestPayment:d>0?d:0,remainingPrinciple:t>0?t:0,paymentYearIndex:o,paymentYear:i,paymentMonth:r};e.push(m)}return this.schedule=e,this},this.runBindings()},n=new a;n.run(),$(document).ready(function(){"#affordability"==window.location.hash?e(!0,"aside.affordability .insertion-point"):e(!1,"aside.fixed-rate .insertion-point")}),$(".calculators").on("change.zf.tabs down.zf.accordion",function(t,a){-1!=a[0].className.indexOf("affordability")||1==$(a[0]).find(".affordability").length?e(!0,"aside.affordability .insertion-point"):e(!1,"aside.fixed-rate .insertion-point")}),$(".accordion-title").on("click vclick keyup",function(){e(!0,"aside.affordability .insertion-point")}),$("input.number").on("keypress",function(e){return t(e,this)})}),"undefined"!=typeof mlcalc_jquery_noconflict&&jQuery.noConflict(),jQuery(document).ready(function(){jQuery("body").prepend('<div id="MLCalcHolder" style="background: transparent; display: none; position: absolute; z-index: 10001; margin: 0; padding: 0; background: url(http://cdn.mlcalc.com/themes/mlcalc/images/ajax-loader.gif); background-repeat: no-repeat; background-position: center; text-align:center;"></div><div id="MLCalcShader" style="background: #000000; display: none; position: absolute; z-index: 10000; margin: 0; padding: 0;"></div><div id="MLCalcClose" style="display: none; color: #414244; font-size: 18px; font-weight: bold; font-family: Arial; cursor: pointer; position: absolute; background: #414244; border: 1px solid #414244; z-index: 10002; text-align: center; padding-top: 1px;">X</div>'),jQuery("body").prepend('<form action="http://www.mlcalc.com/" method="post" id="mlcalcMortgageForm" style="display:none"><input type="hidden" name="cl" value="true" /><input type="hidden" name="wl" value="en" /><input type="hidden" name="ml" value="mortgage" /><input type="hidden" name="cl" value="true" /><input type="hidden" name="wg" value="widget" /><input type="hidden" name="ma" value="" /><input type="hidden" name="dp" value="" /><input type="hidden" name="mt" value="" /><input type="hidden" name="ir" value="" /><input type="hidden" name="pt" value="" /><input type="hidden" name="pi" value="" /><input type="hidden" name="mi" value="" /><input type="hidden" name="sm" value="" /><input type="hidden" name="sy" value="" /><input type="hidden" name="as" value="" /><input type="hidden" name="mi" value="" /><input type="hidden" name="cr" value="usd" /></form>'),jQuery("body").prepend('<form action="http://www.mlcalc.com/" method="post" id="mlcalcLoanForm" style="display:none"><input type="hidden" name="cl" value="true" /><input type="hidden" name="wl" value="en" /><input type="hidden" name="ml" value="loan" /><input type="hidden" name="cl" value="true" /><input type="hidden" name="wg" value="widget" /><input type="hidden" name="la" value="" /><input type="hidden" name="lt" value="" /><input type="hidden" name="ir" value="" /><input type="hidden" name="sm" value="" /><input type="hidden" name="sy" value="" /><input type="hidden" name="as" value="" /><input type="hidden" name="cr" value="usd" /></form>'),jQuery("A[rel=mlcalc]").click(function(){return processLink(jQuery(this).attr("href")),!1})});var img1=new Image(312,44);img1.src="http://cdn.mlcalc.com/themes/mlcalc/images/ajax-loader.gif",$(".numbersOnly").on("change",function(){this.value=this.value.replace(/[^0-9\.]/g,"")});
//# sourceMappingURL=fixedrate.min.js.map